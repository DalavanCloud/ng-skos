angular.module("ngSKOS",["ngSanitize"]).value("version","0.0.2"),angular.module("ngSKOS").directive("skosBrowser",function(){return{restrict:"E",scope:{concept:"=concept",scheme:"=conceptScheme"},templateUrl:function(elem,attrs){return attrs.templateUrl?attrs.templateUrl:"template/skos-browser.html"},link:function(scope){angular.forEach(["URI","Notation","Label"],function(value){var lookup=scope.scheme["lookup"+value];lookup&&(scope["select"+value]=function(query){console.log("skosBrowser.select"+value+": "+query),lookup(query).then(function(response){angular.copy(response,scope.concept)})})}),scope.selectConcept=function(concept){scope.selectURI&&concept.uri?scope.selectURI(concept.uri):scope.selectNotation&&concept.notation&&concept.notation.length?scope.selectNotation(concept.notation):scope.selectLabel&&concept.prefLabel&&scope.selectLabel(concept.prefLabel)}}}}),angular.module("ngSKOS").directive("skosConcept",function(){return{restrict:"AE",scope:{concept:"=skosConcept",language:"=language",click:"=skosClick"},templateUrl:function(elem,attrs){return attrs.templateUrl?attrs.templateUrl:"template/skos-concept.html"},link:function(scope){scope.isEmptyObject=function(){var keys=Object.keys;return!(keys&&keys.length)},scope.$watch("concept",function(concept){angular.forEach(["uri","inScheme","ancestors","prefLabel","altLabel","note","notation","narrower","broader","related"],function(field){scope[field]=concept?concept[field]:null})},!0)}}}),angular.module("ngSKOS").directive("skosLabel",function(){return{restrict:"A",scope:{label:"=skosLabel"},template:"{{label[language] ? label[language] : label}}",link:function(scope,element,attrs){function updateLanguage(language){scope.language=language?language:attrs.lang,language=scope.label?selectLanguage(scope.label,scope.language):"",language!=scope.language&&(scope.language=language)}function selectLanguage(labels,language){if(angular.isObject(labels)){if(language&&labels[language])return language;for(language in labels)return language}}attrs.$observe("lang",updateLanguage),scope.$watch("label",function(){updateLanguage()},!0)}}}),angular.module("ngSKOS").directive("skosList",["$timeout",function($timeout){return{restrict:"E",scope:{concepts:"=concepts",onSelect:"=onSelect",canRemove:"=removeable",showLabels:"=showLabels",language:"=language"},templateUrl:function(elem,attrs){return attrs.templateUrl?attrs.templateUrl:"template/skos-list.html"},link:function(scope){scope.$watch("concepts"),scope.ID=Math.random().toString(36).slice(2),scope.removeConcept=function(index){scope.concepts.splice(index,1)},scope.focusConcept=function(index){var fc=angular.element("[list-id="+scope.ID+"_"+index+"]");fc.focus()},scope.tabFocus=0,scope.onClick=function(index){scope.tabFocus=index,scope.onSelect(scope.concepts[index])},scope.onFocus=function(index){scope.tabFocus=index},scope.onKeyDown=function($event,first,last,index){var key=$event.keyCode,length=scope.concepts.length;-1!=[38,40,46,13].indexOf(key)&&0!=length&&($event.preventDefault(),38==key?(scope.tabFocus=(scope.tabFocus+length-1)%length,$timeout(function(){scope.focusConcept(scope.tabFocus)},0,!1)):40==key?(scope.tabFocus=(scope.tabFocus+1)%length,$timeout(function(){scope.focusConcept(scope.tabFocus)},0,!1)):46==key&&1==scope.canRemove?(last&&scope.tabFocus--,scope.removeConcept(index),$timeout(function(){scope.focusConcept(scope.tabFocus)},0,!1)):13==key&&($event.preventDefault(),scope.onSelect(scope.concepts[index])))}}}}]),angular.module("ngSKOS").directive("skosTree",["$compile",function($compile){return{restrict:"A",transclude:!0,scope:{tree:"=skosTree",language:"=language"},templateUrl:function(elem,attrs){return attrs.templateUrl?attrs.templateUrl:"template/skos-tree.html"},compile:function(tElement,tAttr,transclude){var compiledContents,contents=tElement.contents().remove();return function(scope,iElement){compiledContents||(compiledContents=$compile(contents,transclude)),compiledContents(scope,function(clone){iElement.append(clone)})}}}}]),angular.module("ngSKOS").factory("SkosConceptProvider",["SkosHTTPProvider",function(SkosHTTPProvider){var SkosConceptProvider=function(args){SkosHTTPProvider.call(this,args)};return SkosConceptProvider.prototype=new SkosHTTPProvider,SkosConceptProvider.prototype.getConcept=function(concept){var url;if(this.url)if(angular.isFunction(this.url))url=this.url(concept);else{if(url=this.url,concept.notation){var notation=concept.notation[0];url=url.replace("{notation}",decodeURIComponent(notation))}url=url.replace("{uri}",decodeURIComponent(concept.uri))}else url=concept.uri;return this.get(url)},SkosConceptProvider.prototype.updateConcept=function(concept){return this.getConcept(concept).then(function(response){angular.copy(response,concept)})},SkosConceptProvider.prototype.updateConnected=function(concept,which){angular.isString(which)?which=[which]:angular.isArray(which)||(which=["broader","narrower","related"]);var service=this;angular.forEach(which,function(w){angular.forEach(concept[w],function(c){service.updateConcept(c)})})},SkosConceptProvider}]),angular.module("ngSKOS").factory("SkosHTTPProvider",["$http","$q",function($http,$q){var SkosHTTPProvider=function(args){args||(args={}),this.transform=args.transform,this.url=args.url;var jsonp=args.jsonp;jsonp&&(jsonp===!0||angular.isNumber(jsonp)||jsonp.match(/^\d/))&&(jsonp="callback"),this.jsonp=jsonp};return SkosHTTPProvider.prototype={get:function(url){url||(url=this.url);var transform=this.transform,get=$http.get;return this.jsonp&&(get=$http.jsonp,url+=-1==url.indexOf("?")?"?":"&",url+=this.jsonp+"=JSON_CALLBACK"),get(url).then(function(response){try{return transform?transform(response.data):response.data}catch(e){return console.error(e),$q.reject(e)}},function(response){return console.error(response),$q.reject(response.data)})}},SkosHTTPProvider}]),angular.module("ngSKOS").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/skos-browser.html",'<div ng-if="scheme.suggest" style="margin:1em 0em"><input class="form-control" suggest-typeahead="scheme.suggest" typeahead-on-select="selectNotation($item.description)" ng-model="conceptLabel" placeholder="Search by terms (typeahead)" typeahead-loading="loading" typeahead-editable="false"> <i ng-show="loading" class="glyphicon glyphicon-refresh typeahead-loading"></i></div><div ng-if="selectNotation" class="search-top" style="overflow:hidden;margin-bottom:15px"><form ng-submit="selectNotation(notation)"><span style="float:left"><input class="form-control search-top-input" ng-model="notation" placeholder="Enter full notation"></span> <button type="submit" ng-disabled="!notation.length" class="search-top-button"><span class="glyphicon glyphicon-search"></span></button></form></div><div skos-concept="concept" skos-click="selectConcept" language="language"></div>'),$templateCache.put("template/skos-concept-thesaurus.html",'<div class="skos-concept-thesaurus"><ul ng-if="ancestors.length" class="ancestors"><span ng-if="inScheme" class="classification">{{inScheme}}</span><li class="ancestor" ng-repeat="a in ancestors"><span skos-label="a.prefLabel" lang="{{language}}" ng-click="update(a);reload();"></span></li></ul><div class="top top-classic"><span ng-if="notation" class="notation">{{notation[0]}}</span> <b><span skos-label="concept.prefLabel" lang="{{language}}"></span></b><a ng-if="notation" class="uri" href="{{uri}}"><span style="vertical-align:-10%" class="glyphicon glyphicon-globe"></span></a></div><div ng-if="altLabel.length" class="skos-concept-altlabel"><ul><li ng-repeat="alt in altLabel"><span ng-if="$index < 5" style="display:inline"><span skos-label="alt"></span> <span style="margin-left:-4px;margin-right:3px" ng-if="$index < 4 && $index < altLabel.length-1">,</span></span></li></ul></div><div ng-if="broader.length" class="skos-concept-thesaurus-relation"><b>Broader Terms:</b><ul ng-repeat="b in broader"><li><span skos-label="b.prefLabel" lang="{{language}}" ng-click="click(b)"></li></ul></div><div ng-if="narrower.length" class="skos-concept-thesaurus-relation"><b>Narrower Terms:</b><ul ng-repeat="n in narrower"><li><span skos-label="n.prefLabel" lang="{{language}}" ng-click="click(n)"></li></ul></div><div ng-if="related.length" class="skos-concept-thesaurus-relation"><b>Related Terms:</b><ul ng-repeat="r in related"><li><span skos-label="r.prefLabel" lang="{{language}}" ng-click="click(r)"></li></ul></div></div>'),$templateCache.put("template/skos-concept.html",'<div class="skos-concept"><div class="top top-alt"><span ng-if="notation.length" class="notation">{{notation[0]}}</span> <b><span ng-if="prefLabel" skos-label="concept.prefLabel" lang="{{language}}"></span></b> <a ng-if="uri && uri != notation" class="uri" href="{{uri}}"><span class="glyphicon glyphicon-globe"></span></a></div><div ng-if="altLabel.length" class="skos-concept-altlabel"><ul><li ng-repeat="alt in altLabel"><span ng-if="$index < 5" style="display:inline"><span skos-label="alt" lang="{{language}}"></span></span> <span style="margin-left:-4px;margin-right:3px" ng-if="$index < 4 && $index < altLabel.length-1">,</span></li></ul></div><div ng-if="broader.length || narrower.length || related.length" class="skos-concept-connected"><div ng-if="broader.length" class="skos-concept-relation skos-concept-relation-broader"><ul ng-repeat="c in broader"><li><span skos-label="c.prefLabel" lang="{{language}}" ng-click="click(c)" title="{{c.notation[0]}}"></span></li></ul></div><div ng-if="narrower.length" class="skos-concept-relation skos-concept-relation-narrower"><ul ng-repeat="c in narrower"><li><span skos-label="c.prefLabel" lang="{{language}}" ng-click="click(c)" title="{{c.notation[0]}}"></span></li></ul></div><div ng-if="related.length" class="skos-concept-relation skos-concept-relation-related"><ul ng-repeat="c in related"><li><span skos-label="c.prefLabel" lang="{{language}}" ng-click="click(c)" title="{{c.notation[0]}}"></span></li></ul></div></div><div ng-if="!isEmptyObject(note)" style="margin-top:10px"><div ng-repeat="n in note" lang="{{language}}" style="width:100%;padding:4px 6px;border:1px solid #ddd;margin-top:8px"><em><div skos-label="n"></div></em></div></div></div>'),$templateCache.put("template/skos-list.html",'<ul ng-if="concepts.length" class="skos-simple-list"><li ng-repeat="c in concepts"><div class="set" tabindex="0" ng-keydown="onKeyDown($event, $first, $last, $index)" list-id="{{ID + \'_\' + $index}}" ng-focus="onFocus($index)"><span style="whitespace:nowrap" class="notation skos-list-notation" title="{{c.prefLabel}}" ng-click="onClick($index)">{{c.notation[0]}}</span> <span ng-if="showLabels" skos-label="c.prefLabel" lang="{{language}}" class="skos-list-label" ng-click="onClick($index)"></span><div style="display:inline-table;padding-left:3px"><a href="" ng-click="onSelect(c)" style="text-decoration:none"><span style="vertical-align:middle;top:0px" class="glyphicon glyphicon-info-sign" title="Select concept (ENTER)"></span></a> <a ng-if="canRemove" href="" ng-click="removeConcept($index)" style="text-decoration:none"><span style="vertical-align:middle;top:0px" class="glyphicon glyphicon-trash" title="Remove concept (DEL)"></span></a></div></div></li></ul>'),$templateCache.put("template/skos-tree.html",'<div style="" class="skos-tree"><p class="set" ng-if="!tree.topConcepts"><span ng-if="tree.notation.length" class="notation" style="white-space:nowrap">{{tree.notation[0]}}</span> <span skos-label="tree.prefLabel" lang="{{language}}" style="padding-left:3px"></span></p><ul><li ng-repeat="n in tree.narrower ? tree.narrower : tree.topConcepts"><span skos-tree="n" language="language"></span></li></ul></div>')}]);